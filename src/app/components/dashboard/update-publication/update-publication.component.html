<!-- update-publication.component.html -->
<form [formGroup]="form" class="space-y-4 max-h-[70vh] pr-4 w-[420]">
  <div class="mb-4 grid grid-cols-2 gap-4">
    <app-text-field
      id="title"
      label="{{ 'components.publications.edit.fields.name.title' | transloco }}"
      [control]="form.get('title')"
      [errorMessages]="{
        required: ( 'components.publications.edit.fields.name.required' | transloco ),
        minlength: ( 'components.publications.edit.fields.name.minlength' | transloco ),
        duplicateTitle: ( 'components.publications.edit.fields.name.duplicateTitle' | transloco ),
      }"
    ></app-text-field>
    <app-select
      [placeholder]="
        'components.publications.edit.fields.category.title' | transloco
      "
      [options]="categories"
      formControlName="publication_category"
      [control]="form.get('publication_category')"
      [errorMessages]="{
        required: ( 'components.publications.edit.fields.category.required' | transloco ),
      }"
    ></app-select>
  </div>
  <hr class="border-gray-500 my-1 border-opacity-10" />
  <div class="field">
    <!-- Document File Upload -->
    <app-file-upload
      label="{{
        'components.publications.edit.fields.document.title' | transloco
      }}"
      accept=".pdf,.zip"
      [allowedExtensions]="['.pdf', '.zip']"
      [maxFileSize]="10 * 1024 * 1024"
      fileUploadText="{{
        'components.publications.edit.fields.document.select' | transloco
      }}"
      fileRecommendation="{{
        'components.publications.edit.fields.document.recommendation'
          | transloco
      }}"
      (fileSelected)="onDocumentUploaded($event)"
      (fileRemoved)="removeDocument()"
      (fileError)="onDocumentError($event)"
    ></app-file-upload>
    <!-- Document Preview Section -->
    <div class="mt-4 relative h-[100px]">
      <!-- Loading state -->
      <div
        *ngIf="loadingDocument"
        class="absolute inset-0 flex items-center justify-center bg-gray-50 dark:bg-gray-800 rounded-lg"
      >
        <div class="text-center">
          <div
            class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-2"
          ></div>
          <span class="text-gray-600 dark:text-gray-300 text-sm">{{
            "components.publications.edit.fields.document.loading" | transloco
          }}</span>
        </div>
      </div>
      <!-- Document Preview - Cuando hay documento (nuevo o existente) -->
      <div
        *ngIf="(selectedDocument || hasExistingDocument) && !loadingDocument"
        class="absolute inset-0 flex items-center justify-center bg-white rounded-lg border-2 border-dashed border-gray-500"
      >
        <div class="text-center">
          <!-- Icono ZIP SVG personalizado -->
          <svg
            *ngIf="isZipFile()"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            fill="currentColor"
            [class]="
              'bi bi-file-earmark-zip mb-2 inline-block ' +
              getDocumentIconColor()
            "
            style="margin-right: 2px"
            viewBox="0 0 16 16"
          >
            <path
              d="M5 7.5a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v.938l.4 1.599a1 1 0 0 1-.416 1.074l-.93.62a1 1 0 0 1-1.11 0l-.929-.62a1 1 0 0 1-.415-1.074L5 8.438zm2 0H6v.938a1 1 0 0 1-.03.243l-.4 1.598.93.62.929-.62-.4-1.598A1 1 0 0 1 7 8.438z"
            />
            <path
              d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1h-2v1h-1v1h1v1h-1v1h1v1H6V5H5V4h1V3H5V2h1V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5z"
            />
          </svg>
          <!-- Icono PrimeIcons para PDF u otros -->
          <i
            *ngIf="!isZipFile()"
            [class]="
              'pi ' +
              getDocumentIcon() +
              ' mb-2 inline-block ' +
              getDocumentIconColor()
            "
            style="font-size: 24px; margin-right: 2px"
          ></i>
          <p class="text-sm text-gray-600 dark:text-gray-400">
            {{ getDocumentName() }}
          </p>
          <button
            type="button"
            (click)="removeDocument()"
            class="absolute top-2 right-2 text-red-500 bg-transparent transition-all duration-200 p-1 rounded-full"
          >
            <i class="pi pi-trash text-lg"></i>
          </button>
        </div>
      </div>
      <!-- Estado cuando no hay documento -->
      <div
        *ngIf="!selectedDocument && !hasExistingDocument && !loadingDocument"
        class="absolute inset-0 flex items-center justify-center"
      >
        <div
          [class.border-red-500]="
            form.get('file')?.invalid && form.get('file')?.touched
          "
          [class.border-gray-500]="
            !(form.get('file')?.invalid && form.get('file')?.touched)
          "
          class="w-full h-full flex flex-col items-center justify-center p-4 border-2 border-dashed rounded-lg bg-white dark:bg-gray-800/50"
        >
          <i
            class="pi pi-file text-2xl text-gray-400 dark:text-gray-500 mb-2"
          ></i>
          <p class="text-sm text-gray-500 dark:text-gray-400 text-center">
            <span class="block font-medium">{{
              "components.publications.edit.fields.document.nodata.title"
                | transloco
            }}</span>
            <span class="block text-xs mt-1 opacity-75">
              {{
                "components.publications.edit.fields.document.nodata.subtitle"
                  | transloco
              }}
            </span>
          </p>
        </div>
      </div>
    </div>
    <div
      *ngIf="form.get('file')?.invalid && form.get('file')?.touched"
      class="text-red-500 text-sm mt-2 mb-2"
    >
      {{ "components.publications.edit.fields.document.required" | transloco }}
    </div>
  </div>
  <hr class="border-gray-500 my-1 border-opacity-10" />
  <div class="field">
    <!-- File Upload -->
    <app-file-upload
      #fileUpload
      label="{{
        'components.publications.edit.fields.image.title' | transloco
      }}"
      accept="image/*"
      [maxFileSize]="1024 * 1024"
      fileUploadText="{{ 'image.select' | transloco }}"
      fileRecommendation="{{
        'components.publications.edit.fields.image.recommendation' | transloco
      }}"
      (fileSelected)="onFileUploaded($event)"
      (fileRemoved)="removeFile()"
      (fileError)="onFileError($event)"
    ></app-file-upload>
    <!-- Contenedor de altura fija para la previsualizaciÃ³n -->
    <div class="mt-4 relative h-[240px]">
      <!-- Loading state -->
      <div
        *ngIf="loadingImage"
        class="absolute inset-0 flex items-center justify-center bg-gray-50 dark:bg-gray-800 rounded-lg"
      >
        <div class="text-center">
          <div
            class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-2"
          ></div>
          <span class="text-gray-600 dark:text-gray-300 text-sm">{{
            "image.loading" | transloco
          }}</span>
        </div>
      </div>
      <!-- Image Preview Section -->
      <div
        *ngIf="imageUrl && !loadingImage"
        class="absolute inset-0 flex flex-col"
      >
        <!-- Preview Container -->

        <div
          class="flex-1 flex items-center justify-center bg-white rounded-lg border-2 border-dashed border-gray-500"
        >
          <div class="relative inline-block">
            <!-- Image Container -->
            <div
              class="relative overflow-hidden rounded-lg shadow-md border-2 border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-800"
            >
              <img
                [src]="imageUrl"
                class="max-w-[280px] max-h-[240px] min-w-[200px] min-h-[150px] object-contain p-2 rounded-lg"
                alt="{{ 'image.alt' | transloco }}"
              />
            </div>
            <!-- Delete Button - Estilo mejorado con Tailwind -->
            <button
              type="button"
              (click)="removeFile()"
              class="absolute top-0 right-2 text-red-500 bg-transparent transition-all duration-200 p-1 rounded-full"
              tooltipPosition="top"
            >
              <i class="pi pi-trash text-lg"></i>
            </button>
          </div>
        </div>
        <!-- Info Message - Fijo en la parte inferior -->
        <div class="mt-auto pt-3">
          <p class="text-sm text-gray-600 dark:text-gray-400 text-center">
            <i class="pi pi-info-circle mr-1"></i>
            {{ "image.info" | transloco }}
          </p>
        </div>
      </div>
      <!-- Estado cuando no hay imagen -->
      <div
        *ngIf="!imageUrl && !loadingImage"
        class="absolute inset-0 flex items-center justify-center"
      >
        <div
          [class.border-red-500]="
            form.get('photo')?.invalid && form.get('photo')?.touched
          "
          [class.border-gray-500]="
            !(form.get('photo')?.invalid && form.get('photo')?.touched)
          "
          class="w-full h-full flex flex-col items-center justify-center p-6 border-2 border-dashed rounded-lg bg-white dark:bg-gray-800/50"
        >
          <i
            class="pi pi-image text-4xl text-gray-400 dark:text-gray-500 mb-3"
          ></i>
          <p class="text-sm text-gray-500 dark:text-gray-400 text-center">
            <span class="block font-medium">{{
              "image.nodata.title" | transloco
            }}</span>
            <span class="block text-xs mt-1 opacity-75">
              {{ "image.nodata.subtitle" | transloco }}
            </span>
          </p>
        </div>
      </div>
    </div>
    <div
      *ngIf="form.get('photo')?.invalid && form.get('photo')?.touched"
      class="text-red-500 text-sm mt-2 mb-2"
    >
      {{ "image.required" | transloco }}
    </div>
  </div>
</form>
<style>
  /* Estilos para override de PrimeNG */
  :host ::ng-deep .p-fileupload-content {
    display: none !important;
  }
  :host ::ng-deep app-file-upload label {
    font-weight: bold !important;
    color: black !important;
    font-size: 14px;
  }
</style>
