<div
  class="h-full items-center shadow-[0_4px_20px_rgba(0,0,0,0.5)] dark:shadow-[0_4px_20px_rgba(0,0,0,0.5)] rounded-lg"
>
  <div
    class="bg-[rgb(232,232,232)] dark:bg-[rgb(15,14,14)] dark:border-gray-200 rounded-lg sm:p-4 border-2 border-gray-600 shadow-[0_4px_20px_rgba(0,0,0,0.5)]"
  >
    <h1
      class="ml-2 sm:ml-0 text-2xl font-bold text-gray-700 dark:text-gray-300"
    >
      {{ "components.products.list.title" | transloco }}
    </h1>

    <!-- La tabla con signals -->
    <div class="mt-4">
      <app-table
        [data]="data()"
        [columns]="columns()"
        [loading]="loading()"
        [customTemplates]="customTemplates()"
        [headerActions]="headerActions()"
        [rowActions]="rowActions()"
        (refresh)="onRefresh()"
      >
      </app-table>
    </div>

    <!-- Template para variantes -->
    <ng-template #variantsTemplate let-rowData>
      <div class="text-sm text-gray-700 dark:text-gray-300">
        {{
          rowData.variantsText ||
            ("components.products.list.table.variants.novariants" | transloco)
        }}
      </div>
    </ng-template>

    <!-- Template para imÃ¡genes y videos -->
    <ng-template #imageTemplate let-rowData let-field="field">
      <div class="flex justify-center items-center">
        <div class="relative">
          <!-- Mostrar imagen si NO es video -->
          @if (!rowData.isVideo) {
          <div>
            @if (getImageUrl(rowData)) {
            <img
              [src]="getImageUrl(rowData)"
              [alt]="rowData.firstFileTitle || 'Imagen del producto'"
              class="w-16 h-16 object-cover rounded-lg shadow-md border border-gray-300 dark:border-gray-600 transition-transform duration-200 hover:scale-105"
              (error)="onImageError($event)"
              loading="lazy"
              [title]="rowData.firstFileTitle || ''"
            />
            } @if (!getImageUrl(rowData) && rowData.firstImagePath) {
            <div
              class="w-16 h-16 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-center justify-center border border-gray-300 dark:border-gray-600"
            >
              <svg
                class="w-8 h-8 text-gray-400 dark:text-gray-500"
                fill="currentColor"
                viewBox="0 0 20 20"
              >
                <path
                  fill-rule="evenodd"
                  d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z"
                  clip-rule="evenodd"
                ></path>
              </svg>
            </div>
            } @if (!rowData.firstImagePath) {
            <div
              class="w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center border border-dashed border-gray-300 dark:border-gray-600"
            >
              <i
                class="pi pi-image text-gray-400 dark:text-gray-500 text-xl"
              ></i>
            </div>
            }
          </div>
          }

          <!-- Mostrar miniatura de video si ES video -->
          @if (rowData.isVideo) {
          <div>
            @if (getVideoUrl(rowData)) {
            <div class="relative">
              <video
                [src]="getVideoUrl(rowData)"
                class="w-16 h-16 object-cover rounded-lg shadow-md border border-gray-300 dark:border-gray-600"
                muted
                playsinline
                disablePictureInPicture
                [title]="rowData.firstFileTitle || ''"
              ></video>
              <div
                class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-30 rounded-lg"
              >
                <i class="pi pi-play text-white text-xl"></i>
              </div>
            </div>
            } @if (!getVideoUrl(rowData) && rowData.firstImagePath) {
            <div
              class="w-16 h-16 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-center justify-center border border-gray-300 dark:border-gray-600"
            >
              <i
                class="pi pi-video text-gray-400 dark:text-gray-500 text-xl"
              ></i>
            </div>
            } @if (!rowData.firstImagePath) {
            <div
              class="w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center border border-dashed border-gray-300 dark:border-gray-600"
            >
              <i
                class="pi pi-video text-gray-400 dark:text-gray-500 text-xl"
              ></i>
            </div>
            }
          </div>
          }

          <!-- Badge que muestra la cantidad de archivos adicionales -->
          @if (rowData.files && rowData.files.length > 1) {
          <div
            class="absolute -top-2 -right-2 bg-gray-800 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center font-bold border-2 border-white dark:border-gray-800"
            [title]="'Total de archivos: ' + rowData.files.length"
          >
            +{{ rowData.files.length - 1 }}
          </div>
          }
        </div>
      </div>
    </ng-template>
  </div>
</div>
