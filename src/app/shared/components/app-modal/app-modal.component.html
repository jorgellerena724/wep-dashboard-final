<p-dialog
  [visible]="visible()"
  (visibleChange)="visible.set($event)"
  [modal]="true"
  [closeOnEscape]="true"
  [dismissableMask]="false"
  (onHide)="closeModal()"
  [styleClass]="computedModalClass()"
  [breakpoints]="{ '960px': '75vw', '640px': '100vw' }"
  [focusOnShow]="false"
  [showHeader]="true"
>
  <!-- Header personalizado con título -->
  <ng-template pTemplate="header">
    <div class="flex items-center justify-between w-full">
      <span class="font-semibold text-lg text-gray-700 dark:text-gray-300">{{
        title()
      }}</span>
      <div class="flex items-center gap-2">
        <!-- Botón de expandir/contraer -->
        @if (showExpandButton()) {
          <button
            type="button"
            (click)="toggleExpand()"
            class="p-dialog-header-icon p-link p-button-icon-only p-button-rounded flex items-center justify-center"
            [attr.aria-label]="isExpanded() ? 'Contraer' : 'Expandir'"
          >
            <span
              [class]="
                isExpanded() ? 'pi pi-window-minimize' : 'pi pi-window-maximize'
              "
            ></span>
          </button>
        }
      </div>
    </div>
  </ng-template>

  <ng-container #dynamicContent></ng-container>

  <!-- HR del final -->
  <hr class="border-t border-gray-300 w-full dark:border-gray-300 mt-4" />

  <!-- Footer con botones -->
  @if (modalButtonsVisible()) {
    <ng-template pTemplate="footer">
      <div class="flex justify-end gap-4 mt-1">
        <button
          pButton
          (click)="closeModal()"
          label="Cancelar"
          class="w-full gap-2 p-2 text-white rounded-lg transition-colors duration-300 bg-red-800 hover:bg-red-700 mb-2 border border-red-800 hover:border-red-700"
          [disabled]="isProcessing()"
        ></button>
        <button
          pButton
          (click)="onAccept()"
          label="Aceptar"
          [loadingIcon]="'pi pi-spin pi-spinner text-white'"
          [ngStyle]="{
            '--p-button-loading-icon-color': '#ffffff',
            color: '#ffffff',
          }"
          class="w-full gap-2 p-2 text-white rounded-lg transition-colors duration-300 bg-green-800 hover:bg-green-700 mr-2 mb-2 border border-green-800 hover:border-green-700"
          [disabled]="isProcessing()"
          [loading]="loading()"
        ></button>
      </div>
    </ng-template>
  }
</p-dialog>

<style>
  /* Estilos básicos del modal */
  :host ::ng-deep .custom-modal .p-dialog {
    max-width: 90vw;
    width: 90vw;
  }

  :host ::ng-deep .custom-modal .p-dialog-content {
    padding: 1rem 1.5rem;
    overflow-y: auto;
    overflow-x: auto;
    max-height: 70vh;
  }

  :host ::ng-deep .custom-modal .p-dialog-header {
    padding: 1rem 1.5rem;
    border-bottom: 1px solid #e5e7eb;
  }

  :host ::ng-deep .custom-modal .p-dialog-footer {
    padding: 1rem 1.5rem;
  }

  /* Estilos para los botones del header */
  :host ::ng-deep .custom-modal .p-dialog-header-icon {
    width: 2.5rem;
    height: 2.5rem;
    display: flex !important;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: background-color 0.2s;
    cursor: pointer;
    color: #374151 !important;
  }

  :host ::ng-deep .custom-modal .p-dialog-header-icon:hover {
    background-color: #e5e7eb;
  }

  :host ::ng-deep .custom-modal .p-dialog-header-icon .pi {
    font-size: 1rem;
    color: #374151 !important;
  }

  :host ::ng-deep .custom-modal .p-dialog-header-icon span {
    color: #374151 !important;
  }

  /* Estilos para botones deshabilitados */
  :host ::ng-deep .custom-modal .p-button:disabled,
  :host ::ng-deep .custom-modal .p-button.p-disabled {
    opacity: 1 !important;
    pointer-events: none;
  }

  /* Color blanco para spinner de carga */
  :host ::ng-deep .custom-modal .p-button {
    --p-button-loading-icon-color: #ffffff;
  }

  :host ::ng-deep .custom-modal .p-button .p-button-loading-icon,
  :host ::ng-deep .custom-modal .p-button .pi.pi-spinner {
    color: #ffffff !important;
  }

  :host ::ng-deep .custom-modal .p-button:disabled .p-button-loading-icon,
  :host ::ng-deep .custom-modal .p-button:disabled .p-button-icon,
  :host ::ng-deep .custom-modal .p-button:disabled .p-button-label {
    color: #ffffff !important;
  }

  /* Estilos para el modal expandido - DEBEN IR DESPUÉS para sobrescribir */
  :host ::ng-deep .p-dialog.custom-modal-expanded {
    max-width: 100vw !important;
    width: 95vw !important;
    height: 100vh !important;
    margin: 0 !important;
    border-radius: 0.5rem !important;
    top: 0 !important;
    left: 0 !important;
    transform: none !important;
  }

  :host ::ng-deep .p-dialog.custom-modal-expanded .p-dialog-content {
    max-height: calc(100vh - 140px) !important;
    height: calc(100vh - 140px) !important;
    width: 100% !important;
    max-width: 100% !important;
  }

  :host ::ng-deep .p-dialog.custom-modal-expanded .p-dialog-content > * {
    width: 100% !important;
    max-width: 100% !important;
  }

  @media (max-width: 640px) {
    :host ::ng-deep .custom-modal .p-dialog {
      width: 100vw !important;
      max-width: 100vw !important;
    }
  }
</style>
