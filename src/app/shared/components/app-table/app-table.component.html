<div
  class="card border bg-[rgb(232,232,232)] dark:bg-[rgb(15,14,14)] dark:border-gray-200 rounded-lg shadow-[0_0_20px_rgba(0,0,0,0.2),_0_0_40px_rgba(0,0,0,0.15),_0_0_60px_rgba(0,0,0,0.1),_0_0_80px_rgba(0,0,0,0.05)] border-gray-600"
>
  <div
    class="flex items-center justify-between p-2 border-b border-gray-600 dark:border-gray-200"
  >
    <!-- Contenedor para los botones de acción a la izquierda -->
    <div class="flex items-center gap-2">
      @for (action of headerActions(); track action.label) {
        @if (isHeaderActionVisible(action)) {
          <button
            pButton
            [type]="'button'"
            [icon]="action.icon"
            [pTooltip]="action.label"
            tooltipPosition="top"
            [class]="action.class"
            class="w-full sm:w-auto flex items-center justify-center p-2 text-white rounded-lg transition-colors duration-300 hover:border-gray-700 border-gray-800 bg-gray-800 hover:bg-gray-700 mb-1 disabled:bg-neutral-900 disabled:text-gray-400 dark:disabled:bg-neutral-700 dark:disabled:text-gray-400 disabled:cursor-not-allowed"
            (click)="action.onClick()"
            [disabled]="isHeaderActionDisabled(action) || false"
          ></button>
        }
      }
    </div>

    <!-- Botón de refresh a la derecha -->
    <button
      (click)="refreshData()"
      class="p-2 text-gray-800 dark:text-gray-300 transition-colors rotate-on-hover"
      pTooltip="{{ 'table.tooltips.refresh' | transloco }}"
      tooltipPosition="top"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="27"
        height="27"
        fill="currentColor"
        class="bi bi-arrow-clockwise"
        viewBox="0 0 16 16"
      >
        <path
          fill-rule="evenodd"
          d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2z"
        />
        <path
          d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466"
        />
      </svg>
    </button>
  </div>

  <p-table
    #dt
    [value]="displayedData()"
    [columns]="columnsWithActions()"
    styleClass="p-datatable-sm "
    [resizableColumns]="true"
    responsiveLayout="scroll "
    class="w-full"
    [stripedRows]="true"
  >
    <ng-template pTemplate="header">
      <tr>
        @for (col of columnsWithActions(); track col.field) {
          <th
            [pSortableColumn]="
              col.field !== 'actions' && col.sortable ? col.field : undefined
            "
            [width]="col.width"
            class="px-6 bg-[rgb(232,232,232)] dark:bg-[rgb(15,14,14)] py-3 text-left text-xs font-bold text-gray-800 dark:text-gray-300 uppercase tracking-wider border-b-1 border-b-gray-700 dark:border-b-gray-200 dark:border-b-1"
          >
            <div class="flex items-center justify-between gap-2">
              <span>{{ col.header }}</span>
              @if (col.field !== "actions") {
                <div class="flex items-center gap-2">
                  @if (col.sortable) {
                    <p-sortIcon
                      [field]="col.field"
                      class="text-gray-600 dark:text-gray-500 hover:text-gray-800 dark:hover:text-gray-300"
                      pTooltip="{{ 'table.tooltips.sort' | transloco }}"
                      tooltipPosition="top"
                    ></p-sortIcon>
                  }
                  @if (col.filter) {
                    <button
                      type="button"
                      (click)="
                        $event.stopPropagation(); toggleFilter(col.field)
                      "
                      pTooltip="{{ 'table.tooltips.filter' | transloco }}"
                      tooltipPosition="top"
                    >
                      <i
                        class="pi pi-filter text-gray-600 dark:text-gray-500 hover:text-gray-800 dark:hover:text-gray-300"
                      ></i>
                    </button>
                  }
                </div>
              }
            </div>
            @if (col.filter && showFilterInput()[col.field]) {
              <div
                class="mt-2"
                [formGroup]="columnFiltersForm"
                (click)="$event.stopPropagation()"
              >
                <div class="relative">
                  <input
                    type="text"
                    [formControlName]="col.field"
                    class="bg-[rgb(232,232,232)] dark:bg-[rgb(15,14,14)] w-full px-3 py-2 text-sm rounded-md border border-gray-800 dark:border-gray-300"
                    [placeholder]="
                      col.filterPlaceholder || ('table.search' | transloco)
                    "
                  />
                  @if (columnFiltersForm.get(col.field)?.value) {
                    <button
                      type="button"
                      class="absolute right-2 top-1/2 -translate-y-1/2 text-neutral-400 hover:text-neutral-600"
                      (click)="clearFilter(col.field)"
                    >
                      <i class="pi pi-times"></i>
                    </button>
                  }
                </div>
              </div>
            }
          </th>
        }
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-rowData>
      <tr
        class="bg-[rgb(232,232,232)] dark:bg-[rgb(15,14,14)] hover:bg-gray-300 dark:hover:bg-gray-800 transition-colors duration-200"
      >
        @for (col of columnsWithActions(); track col.field) {
          <td
            class="px-6 py-0 whitespace-nowrap text-sm text-neutral-800 dark:text-white border-b border-gray-400 dark:border-gray-600"
          >
            @if (col.field !== "actions") {
              <ng-container
                *ngTemplateOutlet="
                  customTemplates()[col.field] || defaultTemplate;
                  context: { $implicit: rowData, field: col.field }
                "
              >
              </ng-container>
            } @else {
              <div class="flex items-center gap-2">
                @for (action of rowActions(); track $index) {
                  @if (isRowActionVisible(action, rowData)) {
                    <button
                      pButton
                      [icon]="getRowActionIcon(action, rowData)"
                      [pTooltip]="getRowActionLabel(action, rowData)"
                      tooltipPosition="top"
                      (click)="action.onClick(rowData)"
                      [class]="
                        'p-button-text ' + getRowActionClass(action, rowData)
                      "
                      [disabled]="isRowActionDisabled(action, rowData) || false"
                    ></button>
                  }
                }
              </div>
            }
          </td>
        }
      </tr>
    </ng-template>

    <ng-template #defaultTemplate let-rowData let-field="field">
      {{ truncate(rowData[field], 30) }}
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td
          [attr.colspan]="columnsWithActions().length"
          class="text-center py-4 text-gray-500 bg-[rgb(232,232,232)] dark:bg-[rgb(15,14,14)] italic"
        >
          {{ "table.nodata" | transloco }}
        </td>
      </tr>
    </ng-template>
  </p-table>
  <div class="p-2 w-full paginator-container">
    <p-paginator
      [rows]="rowsPerPage()"
      [totalRecords]="totalRecords()"
      [first]="first()"
      (onPageChange)="onPageChange($event)"
      [rowsPerPageOptions]="[7, 10, 15, 25]"
      currentPageReportTemplate="{{
        'table.pagination.first' | transloco
      }} {first} {{ 'table.pagination.second' | transloco }} {last} {{
        'table.pagination.third' | transloco
      }} {totalRecords} {{ 'table.pagination.fourth' | transloco }}"
      [showCurrentPageReport]="true"
      class="bg-[rgb(232,232,232)] dark:bg-[rgb(15,14,14)]"
      [dropdownAppendTo]="'body'"
    ></p-paginator>
  </div>
</div>
<style>
  /* Inputs y Labels (Estilos generales HTML) - No necesitan ng-deep si están en tu template directo */
  input:focus,
  label:focus {
    outline: 1px solid #1f2937;
  }
  .dark input:focus,
  label:focus {
    outline: 1px solid #e5e7eb;
  }
  input[type="text"] {
    font-weight: normal !important;
  }

  /* --- PRIMENG OVERRIDES (Usamos ::ng-deep) --- */

  /* Contenedor del Paginator */
  :host ::ng-deep .p-paginator {
    min-height: 100px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-wrap: wrap;
    background: rgb(232 232 232 / var(--tw-text-opacity, 1));
    color: var(--p-paginator-color);
    padding: var(--p-paginator-padding);
    border-radius: var(--p-paginator-border-radius);
    gap: var(--p-paginator-gap);
  }

  :host ::ng-deep .dark .p-paginator {
    background: #18181b;
  }

  /* Botón de página SELECCIONADA (Aquí estaba tu problema del verde) */
  :host ::ng-deep .p-paginator-page.p-paginator-page-selected {
    background: #9ca3af !important; /* !important para asegurar que pise el tema default */
    pointer-events: none;
    color: white !important;
  }

  :host ::ng-deep .dark .p-paginator-page.p-paginator-page-selected {
    background: #1f2937 !important;
    color: white !important;
  }

  /* Hover en botones */
  :host ::ng-deep .p-paginator-page:hover,
  :host ::ng-deep .p-paginator-next:hover,
  :host ::ng-deep .p-paginator-last:hover,
  :host ::ng-deep .p-paginator-first:hover,
  :host ::ng-deep .p-paginator-prev:hover {
    background: #d1d5db !important;
    color: #343b46 !important;
  }

  :host ::ng-deep .dark .p-paginator-page:hover,
  :host ::ng-deep .dark .p-paginator-next:hover,
  :host ::ng-deep .dark .p-paginator-last:hover,
  :host ::ng-deep .dark .p-paginator-first:hover,
  :host ::ng-deep .dark .p-paginator-prev:hover {
    background: #343b46 !important;
    color: #d1d5db !important;
  }

  /* Color de texto base de los botones */
  :host ::ng-deep .p-paginator-page,
  :host ::ng-deep .p-paginator-next,
  :host ::ng-deep .p-paginator-last,
  :host ::ng-deep .p-paginator-first,
  :host ::ng-deep .p-paginator-prev,
  :host ::ng-deep .p-paginator-current {
    color: #343b46;
  }

  :host ::ng-deep .dark .p-paginator-page,
  :host ::ng-deep .dark .p-paginator-next,
  :host ::ng-deep .dark .p-paginator-last,
  :host ::ng-deep .dark .p-paginator-first,
  :host ::ng-deep .dark .p-paginator-prev,
  :host ::ng-deep .dark .p-paginator-current {
    color: #d1d5db;
  }

  /* Iconos */
  :host ::ng-deep .p-icon {
    color: #343b46;
  }
  :host ::ng-deep .dark .p-icon {
    color: #d1d5db;
  }

  /* Dropdown de opciones (Select) */
  :host ::ng-deep .p-select-option.p-select-option-selected {
    background: #9ca3af !important;
    color: white !important;
  }
  :host ::ng-deep .dark .p-select-option.p-select-option-selected {
    background: #1f2937 !important;
    color: white !important;
  }
  :host ::ng-deep .p-select-option:hover {
    background: #d1d5db !important;
  }
  :host ::ng-deep .dark .p-select-option:hover {
    background: #343b46 !important;
  }

  /* Animación custom */
  @keyframes rotate {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }
  .rotate-on-hover:hover {
    animation: rotate 0.5s linear;
  }

  /* Media Queries */
  @media (max-width: 660px) {
    :host ::ng-deep .p-paginator {
      min-height: 200px;
    }
  }
</style>
